import{r as d,j as e}from"./app-SR_8OJiy.js";import{D as B}from"./data-table-9MQ2a95p.js";import{B as k}from"./badge-Clmcb7u8.js";import{B as F}from"./button-B570qpbR.js";import{C as x,a as u,b as h,d as p}from"./card-B7sdl9K1.js";import{D as K,a as O,b as z,c as J,d as L,e as U}from"./dropdown-menu-DO8p4mWU.js";import{L as f,d as $,M as q}from"./map-leaflet-Cj2NpwK2.js";import{A as G}from"./app-layout-3hR_XK02.js";import{c as g}from"./utils-jAU0Cazi.js";import{R as Q,C as V,a as W}from"./server.browser-BJHo6ZL2.js";import{statuses as N}from"./data-CgBDKHoX.js";import{columns as X}from"./columns-CtEGN68a.js";import Y from"./filter-rentang-tanggal-B9tAGxBh.js";import{i as Z}from"./id-vBssW-nJ.js";import{f as y}from"./format-acRrnPkz.js";import"./index-Dyw962Yq.js";import"./index-DGGzgwal.js";import"./createLucideIcon-C0lteR66.js";import"./index-Dc_XY07c.js";import"./index-C3dRAqJ4.js";import"./chevron-left-q9f51ZSG.js";import"./chevron-right-DMCAsSAb.js";import"./input-D0cZ6BSe.js";import"./command-CPyYDrQD.js";import"./popover-BdIuhU4l.js";import"./separator-DXcJ-kIy.js";import"./index-1lv7o5is.js";import"./use-initials-OnOtn_p8.js";import"./chevrons-up-down-bKKNV-yp.js";import"./app-logo-icon-B9KTRtJZ.js";import"./building-2-DZiF-CZ5.js";import"./plane-BnjyJNby.js";import"./data-table-column-header-DfR9UBYP.js";import"./data-CqSI5ZFc.js";import"./calendar-CxjMwWBG.js";import"./label-BGzv7bFx.js";const ee=[{title:"Kehadiran",href:"/attendances"},{title:"Detail Kehadiran",href:"#"}];function _e({attendances:i,office:o}){const a=d.useRef(null),j=d.useRef(null),b=o.latitude,D=o.longitude,S=f.latLng(b,D),[m,v]=d.useState([]),[A,R]=d.useState(!1),[M,E]=d.useState(null),[C,H]=d.useState(null),P=y(new Date,"yyyy-MM-dd"),w=i.filter(s=>{let t=!0;if(s.tanggal){const r=new Date(s.tanggal),c=M?new Date(M):null;let n=C?new Date(C):null;n&&n.setHours(23,59,59,999),!c&&!n?t=y(r,"yyyy-MM-dd")===P:c&&n?t=r>=c&&r<=n:c?t=r>=c:n&&(t=r<=n)}let l=!0;return m.length>0&&(l=m.includes(String(s.status))),t&&l});d.useEffect(()=>{const s=setTimeout(()=>{a.current&&(a.current.eachLayer(t=>{var l;t instanceof f.Marker&&((l=a.current)==null||l.removeLayer(t))}),j.current&&a.current.removeLayer(j.current),j.current=f.circle(S,{color:"red",radius:o.radius}).addTo(a.current),w.forEach(t=>{const l=N.find(I=>I.value===t.status),r=t.latitude??0,c=t.longitude??0,n=f.latLng(r,c);let T=Q.renderToString(e.jsxs("div",{className:"w-[200px]",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"text-xl text-gray-500"}),e.jsx("h1",{className:"font-bold text-gray-800",children:t.user.name})]}),e.jsx(k,{className:g("mt-2 w-full px-2 py-1 text-xs font-bold",l==null?void 0:l.color),children:l==null?void 0:l.label}),e.jsxs("div",{className:"my-2 flex justify-between rounded-lg text-sm text-gray-700",children:[e.jsxs("div",{className:"flex flex-col items-start gap-y-2",children:[e.jsx("span",{className:"font-medium",children:"Jam Masuk:"}),e.jsx("span",{className:g("rounded-md px-2 py-1 font-semibold",t.clock_in>o.clock_in?"bg-red-100 text-red-500":"bg-green-100 text-green-500"),children:t.clock_in})]}),e.jsxs("div",{className:"flex flex-col items-start gap-y-2",children:[e.jsx("span",{className:"font-medium",children:"Jam Keluar:"}),e.jsx("span",{className:g("rounded-md px-2 py-1 font-semibold",t.clock_out?t.clock_out>o.clock_out?"bg-green-100 text-green-500":"bg-red-100 text-red-500":"bg-gray-200 text-gray-500"),children:t.clock_out||"-"})]})]}),t.swafoto?e.jsxs("div",{className:"relative mt-3",children:[e.jsx("img",{src:"/storage/"+t.swafoto,className:"h-auto w-[200px] rounded-lg border",alt:"Swafoto"}),e.jsx("div",{className:"absolute top-1 left-1 rounded-full bg-black/50 p-1 text-white",children:e.jsx(W,{className:"text-sm"})})]}):e.jsx("p",{className:"mt-3 text-xs text-gray-500 italic",children:"Swafoto tidak tersedia"}),t.tanggal&&e.jsx("p",{className:"mt-2",children:y(t.tanggal,"EEEE, d MMMM yyyy, HH:mm:ss",{locale:Z})})]}));a.current&&f.marker(n,{icon:$}).addTo(a.current).bindPopup(T)}))},100);return()=>clearTimeout(s)},[w,o.radius,S,a.current]);const _=(s,t)=>{v(l=>t?[...l,s]:l.filter(r=>r!==s))};return e.jsx(G,{breadcrumbs:ee,children:e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[e.jsxs("div",{className:"grid w-full grid-cols-1 gap-4 lg:grid-cols-2 xl:grid-cols-5",children:[e.jsxs(x,{className:"w-full",children:[e.jsx(u,{children:e.jsx(h,{children:"Total Hadir"})}),e.jsx(p,{children:e.jsx("h1",{className:"text-4xl",children:i.filter(s=>s.status==="Hadir").length})})]}),e.jsxs(x,{className:"w-full",children:[e.jsx(u,{children:e.jsx(h,{children:"Total Tidak Hadir"})}),e.jsx(p,{children:e.jsx("h1",{className:"text-4xl",children:i.filter(s=>s.status==="Alpa").length})})]}),e.jsxs(x,{className:"w-full",children:[e.jsx(u,{children:e.jsx(h,{children:"Total Sakit"})}),e.jsx(p,{children:e.jsx("h1",{className:"text-4xl",children:i.filter(s=>s.status==="Sakit").length})})]}),e.jsxs(x,{className:"w-full",children:[e.jsx(u,{children:e.jsx(h,{children:"Total Izin"})}),e.jsx(p,{children:e.jsx("h1",{className:"text-4xl",children:i.filter(s=>s.status==="Izin").length})})]}),e.jsxs(x,{className:"w-full",children:[e.jsx(u,{children:e.jsx(h,{children:"Total Perjalanan Dinas"})}),e.jsx(p,{children:e.jsx("h1",{className:"text-4xl",children:i.filter(s=>s.status==="Perjalanan Dinas").length})})]})]}),e.jsx(B,{columns:X(o),data:i,columnFilter:"status",titleFilter:"Status",optionsFilter:N}),e.jsxs(x,{className:"h-auto",children:[e.jsxs(u,{className:"flex flex-col items-center justify-between gap-y-2 md:flex-row",children:[e.jsx(h,{children:"Peta Presensi"}),e.jsxs(K,{open:A,onOpenChange:R,children:[e.jsx(O,{asChild:!0,children:e.jsxs(F,{variant:"outline",className:"w-full md:ml-auto md:w-fit",children:["Filter Status ",m.length>0&&`(${m.length})`]})}),e.jsxs(z,{align:"end",className:"w-56",children:[e.jsx(J,{children:"Filter Status"}),e.jsx(L,{}),N.map(s=>{const t=w.filter(l=>l.status===s.value).length;return e.jsx("div",{onClick:l=>l.stopPropagation(),children:e.jsx(U,{checked:m.includes(s.value),onSelect:l=>l.preventDefault(),onCheckedChange:l=>_(s.value,l),children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-2",children:[e.jsx(k,{className:g("px-2 py-1 text-xs font-bold",s.color),children:s.label}),e.jsx("span",{className:"rounded-full bg-gray-100 px-2 py-1 text-xs font-medium text-gray-500",children:t})]})})},s.value)}),m.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(L,{}),e.jsx(F,{variant:"ghost",className:"w-full justify-start",onClick:()=>v([]),children:"Reset Filter"})]})]}),e.jsx(Y,{attendances:i,setTanggalAkhir:H,setTanggalAwal:E})]})]}),e.jsx(p,{className:"h-[500px]",children:e.jsx(q,{mapRef:a,center:[b,D],zoom:13,className:"overflow-hidden rounded-xl"})})]})]})})}export{_e as default};
