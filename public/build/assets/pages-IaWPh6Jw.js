import{r as o,j as e,L as K}from"./app-SR_8OJiy.js";import{B as k}from"./badge-Clmcb7u8.js";import{B as T}from"./button-B570qpbR.js";import{C as m,a as p,b as h,c as N,d as f}from"./card-B7sdl9K1.js";import{D as z,a as U,b as $,c as q,d as L,e as G}from"./dropdown-menu-DO8p4mWU.js";import{L as x,d as Q,M as V}from"./map-leaflet-Cj2NpwK2.js";import{A as W}from"./app-layout-3hR_XK02.js";import{c as g}from"./utils-jAU0Cazi.js";import{R as X,C as Y,a as Z}from"./server.browser-BJHo6ZL2.js";import{statuses as A}from"./data-CqSI5ZFc.js";import ee from"./filter-rentang-tanggal-B9tAGxBh.js";import{f as P}from"./format-acRrnPkz.js";import"./index-DGGzgwal.js";import"./createLucideIcon-C0lteR66.js";import"./index-Dyw962Yq.js";import"./index-Dc_XY07c.js";import"./index-1lv7o5is.js";import"./use-initials-OnOtn_p8.js";import"./chevrons-up-down-bKKNV-yp.js";import"./app-logo-icon-B9KTRtJZ.js";import"./building-2-DZiF-CZ5.js";import"./chevron-right-DMCAsSAb.js";import"./plane-BnjyJNby.js";import"./calendar-CxjMwWBG.js";import"./chevron-left-q9f51ZSG.js";import"./label-BGzv7bFx.js";import"./popover-BdIuhU4l.js";const se=[{title:"Dashboard",href:"#"}];function Le({attendances:b,countAttendancesToday:te,countAttendances:R,countEmployees:F,office:c}){const a=o.useRef(null),j=o.useRef(null),v=c.latitude,D=c.longitude,S=x.latLng(v,D),[d,C]=o.useState([]),[_,J]=o.useState(!1),B=P(new Date,"yyyy-MM-dd"),[w,E]=o.useState(null),[y,I]=o.useState(null),u=b.filter(l=>{let s=!0;if(l.tanggal){const r=new Date(l.tanggal),i=w?new Date(w):null;let n=y?new Date(y):null;n&&n.setHours(23,59,59,999),!i&&!n?s=P(r,"yyyy-MM-dd")===B:i&&n?s=r>=i&&r<=n:i?s=r>=i:n&&(s=r<=n)}let t=!0;return d.length>0&&(t=d.includes(String(l.status))),s&&t});o.useEffect(()=>{const l=setTimeout(()=>{a.current&&(a.current.eachLayer(s=>{var t;s instanceof x.Marker&&((t=a.current)==null||t.removeLayer(s))}),j.current&&a.current.removeLayer(j.current),j.current=x.circle(S,{color:"red",radius:c.radius}).addTo(a.current),u.forEach(s=>{const t=A.find(H=>H.value===s.status),r=s.latitude??0,i=s.longitude??0,n=x.latLng(r,i);let M=X.renderToString(e.jsxs("div",{className:"w-[200px]",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"text-xl text-gray-500"}),e.jsx("h1",{className:"font-bold text-gray-800",children:s.user.name})]}),e.jsx(k,{className:g("mt-2 w-full px-2 py-1 text-xs font-bold",t==null?void 0:t.color),children:t==null?void 0:t.label}),e.jsxs("div",{className:"my-2 flex justify-between rounded-lg text-sm text-gray-700",children:[e.jsxs("div",{className:"flex flex-col items-start gap-y-2",children:[e.jsx("span",{className:"font-medium",children:"Jam Masuk:"}),e.jsx("span",{className:g("rounded-md px-2 py-1 font-semibold",s.clock_in>c.clock_in?"bg-red-100 text-red-500":"bg-green-100 text-green-500"),children:s.clock_in})]}),e.jsxs("div",{className:"flex flex-col items-start gap-y-2",children:[e.jsx("span",{className:"font-medium",children:"Jam Keluar:"}),e.jsx("span",{className:g("rounded-md px-2 py-1 font-semibold",s.clock_out?s.clock_out>c.clock_out?"bg-green-100 text-green-500":"bg-red-100 text-red-500":"bg-gray-200 text-gray-500"),children:s.clock_out||"-"})]})]}),s.swafoto?e.jsxs("div",{className:"relative mt-3",children:[e.jsx("img",{src:"/storage/"+s.swafoto,className:"h-auto w-[200px] rounded-lg border",alt:"Swafoto"}),e.jsx("div",{className:"absolute top-1 left-1 rounded-full bg-black/50 p-1 text-white",children:e.jsx(Z,{className:"text-sm"})})]}):e.jsx("p",{className:"mt-3 text-xs text-gray-500 italic",children:"Swafoto tidak tersedia"})]}));a.current&&x.marker(n,{icon:Q}).addTo(a.current).bindPopup(M)}))},100);return()=>clearTimeout(l)},[u,c.radius,S,a.current]);const O=(l,s)=>{C(t=>s?[...t,l]:t.filter(r=>r!==l))};return e.jsxs(W,{breadcrumbs:se,children:[e.jsx(K,{title:"Dashboard"}),e.jsxs("div",{className:"flex h-full flex-col gap-4 rounded-xl p-4",children:[e.jsxs("div",{className:"flex w-full flex-col gap-4 gap-y-4 md:flex-row",children:[e.jsxs(m,{className:"w-full",children:[e.jsxs(p,{children:[e.jsx(h,{children:w||y?"Total Presensi":"Total Presensi Hari Ini"}),e.jsx(N,{children:"Jumlah pegawai yang melakukan presensi hari ini"})]}),e.jsx(f,{children:e.jsx("h1",{className:"text-4xl",children:u.length})})]}),e.jsxs(m,{className:"w-full",children:[e.jsxs(p,{children:[e.jsx(h,{children:"Total Presensi Keseluruhan"}),e.jsx(N,{children:"Jumlah keseluruhan presensi"})]}),e.jsx(f,{children:e.jsx("h1",{className:"text-4xl",children:R})})]}),e.jsxs(m,{className:"w-full",children:[e.jsxs(p,{children:[e.jsx(h,{children:"Total Pegawai"}),e.jsx(N,{children:"Jumlah keseluruhan pegawai"})]}),e.jsx(f,{children:e.jsx("h1",{className:"text-4xl",children:F})})]})]}),e.jsx("div",{className:"flex h-[500px] w-full md:h-full",children:e.jsxs(m,{className:"flex flex-1 flex-col",children:[e.jsxs(p,{className:"flex flex-col items-center justify-between gap-y-2 md:flex-row",children:[e.jsx(h,{children:"Peta Presensi"}),e.jsxs(z,{open:_,onOpenChange:J,children:[e.jsx(U,{asChild:!0,children:e.jsxs(T,{variant:"outline",className:"w-full md:ml-auto md:w-fit",children:["Filter Status ",d.length>0&&`(${d.length})`]})}),e.jsxs($,{align:"end",className:"w-56",children:[e.jsx(q,{children:"Filter Status"}),e.jsx(L,{}),A.map(l=>{const s=u.filter(t=>t.status===l.value).length;return e.jsx("div",{onClick:t=>t.stopPropagation(),children:e.jsx(G,{checked:d.includes(l.value),onSelect:t=>t.preventDefault(),onCheckedChange:t=>O(l.value,t),children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-2",children:[e.jsx(k,{className:g("px-2 py-1 text-xs font-bold",l.color),children:l.label}),e.jsx("span",{className:"rounded-full bg-gray-100 px-2 py-1 text-xs font-medium text-gray-500",children:s})]})})},l.value)}),d.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(L,{}),e.jsx(T,{variant:"ghost",className:"w-full justify-start",onClick:()=>C([]),children:"Reset Filter"})]})]}),e.jsx(ee,{attendances:b,setTanggalAkhir:I,setTanggalAwal:E})]})]}),e.jsx(f,{className:"flex flex-1 flex-col",children:e.jsx(V,{mapRef:a,center:[v,D],zoom:13,className:"overflow-hidden rounded-xl"})})]})})]})]})}export{Le as default};
