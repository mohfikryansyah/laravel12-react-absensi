import{r as i,j as e,L as J}from"./app-Bta-wT-b.js";import{B as z}from"./badge-C7i4ggmd.js";import{B as M}from"./button-yj5hMQ3c.js";import{C as p,a as x,b as h,c as y,d as f}from"./card-D-w5G1aT.js";import{D as K,a as U,b as $,c as q,d as T,e as G}from"./dropdown-menu-vHaG0bkZ.js";import{L as u,d as Q,M as V}from"./map-leaflet-DBVFy88C.js";import{A as W}from"./app-layout-DGaG65JJ.js";import{c as X}from"./utils-jAU0Cazi.js";import{R as Y}from"./server.browser-BckF4R1D.js";import{statuses as k}from"./data-BF2YylbN.js";import Z from"./filter-rentang-tanggal-D4d-yCN8.js";import _ from"./popup-content-GD2E1tI2.js";import{f as L}from"./format-acRrnPkz.js";import"./index-8OSeXHHY.js";import"./index-CAD34kM0.js";import"./index-DKj-CO1Z.js";import"./index-D73HEG_a.js";import"./check-IbVnGVfI.js";import"./createLucideIcon-CVuAcCb-.js";import"./index-Be9ZpaHw.js";import"./use-initials-Y_EWJVKO.js";import"./chevrons-up-down-DOgTaHrR.js";import"./app-logo-icon-DxQ8HIrN.js";import"./building-2-xoQ_6p3O.js";import"./chevron-right-BPnegaHu.js";import"./plane-CLLdrjAi.js";import"./calendar-CC-dsLnt.js";import"./chevron-left-8KL3Yjt_.js";import"./label-BWVyYn6N.js";import"./popover-RLZG7F2w.js";import"./circle-user-Chul1KXo.js";const ee=[{title:"Dashboard",href:"#"}];function Re({attendances:D,countAttendancesToday:te,countAttendances:P,countEmployees:A,office:d}){const l=i.useRef(null),g=i.useRef(null),N=d.latitude,S=d.longitude,C=u.latLng(N,S),[c,b]=i.useState([]),[R,F]=i.useState(!1),B=L(new Date,"yyyy-MM-dd"),[j,E]=i.useState(null),[w,I]=i.useState(null),m=D.filter(r=>{let s=!0;if(r.tanggal){const a=new Date(r.tanggal),o=j?new Date(j):null;let n=w?new Date(w):null;n&&n.setHours(23,59,59,999),!o&&!n?s=L(a,"yyyy-MM-dd")===B:o&&n?s=a>=o&&a<=n:o?s=a>=o:n&&(s=a<=n)}let t=!0;return c.length>0&&(t=c.includes(String(r.status))),s&&t});i.useEffect(()=>{const r=setTimeout(()=>{l.current&&(l.current.eachLayer(s=>{var t;s instanceof u.Marker&&((t=l.current)==null||t.removeLayer(s))}),g.current&&l.current.removeLayer(g.current),g.current=u.circle(C,{color:"red",radius:d.radius}).addTo(l.current),m.forEach(s=>{const t=k.find(H=>H.value===s.status),a=s.latitude??0,o=s.longitude??0,n=u.latLng(a,o);let v=Y.renderToString(e.jsx(_,{marker:s,office:d,status:t||{color:"gray",label:"Unknown"}}));l.current&&u.marker(n,{icon:Q}).addTo(l.current).bindPopup(v)}))},100);return()=>clearTimeout(r)},[m,d.radius,C,l.current]);const O=(r,s)=>{b(t=>s?[...t,r]:t.filter(a=>a!==r))};return console.log(),e.jsxs(W,{breadcrumbs:ee,children:[e.jsx(J,{title:"Dashboard"}),e.jsxs("div",{className:"flex h-full flex-col gap-4 rounded-xl p-4",children:[e.jsxs("div",{className:"flex w-full flex-col gap-4 gap-y-4 md:flex-row",children:[e.jsxs(p,{className:"w-full",children:[e.jsxs(x,{children:[e.jsx(h,{children:j||w?"Total Presensi":"Total Presensi Hari Ini"}),e.jsx(y,{children:"Jumlah pegawai yang melakukan presensi hari ini"})]}),e.jsx(f,{children:e.jsx("h1",{className:"text-4xl",children:m.length})})]}),e.jsxs(p,{className:"w-full",children:[e.jsxs(x,{children:[e.jsx(h,{children:"Total Presensi Keseluruhan"}),e.jsx(y,{children:"Jumlah keseluruhan presensi"})]}),e.jsx(f,{children:e.jsx("h1",{className:"text-4xl",children:P})})]}),e.jsxs(p,{className:"w-full",children:[e.jsxs(x,{children:[e.jsx(h,{children:"Total Pegawai"}),e.jsx(y,{children:"Jumlah keseluruhan pegawai"})]}),e.jsx(f,{children:e.jsx("h1",{className:"text-4xl",children:A})})]})]}),e.jsx("div",{className:"flex h-[500px] w-full md:h-full",children:e.jsxs(p,{className:"flex flex-1 flex-col",children:[e.jsxs(x,{className:"flex flex-col items-center justify-between gap-y-2 md:flex-row",children:[e.jsx(h,{children:"Peta Presensi"}),e.jsxs(K,{open:R,onOpenChange:F,children:[e.jsx(U,{asChild:!0,children:e.jsxs(M,{variant:"outline",className:"w-full md:ml-auto md:w-fit",children:["Filter Status ",c.length>0&&`(${c.length})`]})}),e.jsxs($,{align:"end",className:"w-56",children:[e.jsx(q,{children:"Filter Status"}),e.jsx(T,{}),k.map(r=>{const s=m.filter(t=>t.status===r.value).length;return e.jsx("div",{onClick:t=>t.stopPropagation(),children:e.jsx(G,{checked:c.includes(r.value),onSelect:t=>t.preventDefault(),onCheckedChange:t=>O(r.value,t),children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-2",children:[e.jsx(z,{className:X("px-2 py-1 text-xs font-bold",r.color),children:r.label}),e.jsx("span",{className:"rounded-full bg-gray-100 px-2 py-1 text-xs font-medium text-gray-500",children:s})]})})},r.value)}),c.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(T,{}),e.jsx(M,{variant:"ghost",className:"w-full justify-start",onClick:()=>b([]),children:"Reset Filter"})]})]}),e.jsx(Z,{attendances:D,setTanggalAkhir:I,setTanggalAwal:E})]})]}),e.jsx(f,{className:"flex flex-1 flex-col",children:e.jsx(V,{mapRef:l,center:[N,S],zoom:13,className:"overflow-hidden rounded-xl"})})]})})]})]})}export{Re as default};
