import{r as n,j as e,L as K}from"./app-73PXmQ0L.js";import{B as M}from"./badge-BKJStKv9.js";import{B as k}from"./button-DJr14K4H.js";import{C as x,a as u,b as m,c as g,d as f}from"./card-D0s5zf5I.js";import{D as z,a as U,b as $,c as q,d as T,e as G}from"./dropdown-menu-DvkTQ6Bm.js";import{L as c,d as Q,M as V}from"./map-leaflet-DC9GcGW5.js";import{A as W}from"./app-layout-DvvVNhPu.js";import{c as h}from"./utils-jAU0Cazi.js";import{R as X,C as Y,a as Z}from"./server.browser-pUDb-L-X.js";import{statuses as L}from"./data-Cx8KfrcC.js";import ee from"./filter-rentang-tanggal-CmRvf17X.js";import{f as A}from"./format-acRrnPkz.js";import"./index-pV9CKLJr.js";import"./createLucideIcon-DD5_lgfx.js";import"./index-bOE8_Kzt.js";import"./index-UB70wyLq.js";import"./index-DDJRWYR0.js";import"./use-initials-CgDP6PuV.js";import"./chevrons-up-down-DcUrWfdF.js";import"./app-logo-icon-DuJXVUNj.js";import"./building-2-CfzSGeG9.js";import"./chevron-right-CPWzXe3b.js";import"./plane-D2BoD-0i.js";import"./calendar-YcAonO1F.js";import"./chevron-left-wEpvv7Ym.js";import"./label-QG7L0S7C.js";import"./popover-CMGxnPm8.js";const se=[{title:"Dashboard",href:"#"}];function Le({attendances:j,countAttendancesToday:te,countAttendances:R,countEmployees:P,office:i}){const r=n.useRef(null),p=n.useRef(null),w=i.latitude,y=i.longitude,N=c.latLng(w,y),[o,b]=n.useState([]),[_,F]=n.useState(!1),J=A(new Date,"yyyy-MM-dd"),[v,B]=n.useState(null),[D,E]=n.useState(null),d=j.filter(l=>{if(!l.tanggal)return!0;const t=new Date(l.tanggal),s=v?new Date(v):null;let a=D?new Date(D):null;if(a&&a.setHours(23,59,59,999),!s&&!a)return A(t,"yyyy-MM-dd")===J;if(s&&a){if(!(t>=s&&t<=a))return!1}else if(s){if(!(t>=s))return!1}else if(a&&!(t<=a))return!1;return o.length===0||o.includes(l.status)});n.useEffect(()=>{const l=setTimeout(()=>{r.current&&(r.current.eachLayer(t=>{var s;t instanceof c.Marker&&((s=r.current)==null||s.removeLayer(t))}),p.current&&r.current.removeLayer(p.current),p.current=c.circle(N,{color:"red",radius:i.radius}).addTo(r.current),d.forEach(t=>{const s=L.find(H=>H.value===t.status),a=t.latitude??0,S=t.longitude??0,C=c.latLng(a,S);let O=X.renderToString(e.jsxs("div",{className:"w-[200px]",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"text-xl text-gray-500"}),e.jsx("h1",{className:"font-bold text-gray-800",children:t.user.name})]}),e.jsx(M,{className:h("mt-2 w-full px-2 py-1 text-xs font-bold",s==null?void 0:s.color),children:s==null?void 0:s.label}),e.jsxs("div",{className:"my-2 flex justify-between rounded-lg text-sm text-gray-700",children:[e.jsxs("div",{className:"flex flex-col items-start gap-y-2",children:[e.jsx("span",{className:"font-medium",children:"Jam Masuk:"}),e.jsx("span",{className:h("rounded-md px-2 py-1 font-semibold",t.clock_in>i.clock_in?"bg-red-100 text-red-500":"bg-green-100 text-green-500"),children:t.clock_in})]}),e.jsxs("div",{className:"flex flex-col items-start gap-y-2",children:[e.jsx("span",{className:"font-medium",children:"Jam Keluar:"}),e.jsx("span",{className:h("rounded-md px-2 py-1 font-semibold",t.clock_out?t.clock_out>i.clock_out?"bg-green-100 text-green-500":"bg-red-100 text-red-500":"bg-gray-200 text-gray-500"),children:t.clock_out||"-"})]})]}),t.swafoto?e.jsxs("div",{className:"relative mt-3",children:[e.jsx("img",{src:t.swafoto,className:"h-auto w-[200px] rounded-lg border",alt:"Swafoto"}),e.jsx("div",{className:"absolute top-1 left-1 rounded-full bg-black/50 p-1 text-white",children:e.jsx(Z,{className:"text-sm"})})]}):e.jsx("p",{className:"mt-3 text-xs text-gray-500 italic",children:"Swafoto tidak tersedia"})]}));r.current&&c.marker(C,{icon:Q}).addTo(r.current).bindPopup(O)}))},100);return()=>clearTimeout(l)},[d,i.radius,N,r.current]);const I=(l,t)=>{b(s=>t?[...s,l]:s.filter(a=>a!==l))};return e.jsxs(W,{breadcrumbs:se,children:[e.jsx(K,{title:"Dashboard"}),e.jsxs("div",{className:"flex h-full flex-col gap-4 rounded-xl p-4",children:[e.jsxs("div",{className:"flex md:flex-row flex-col gap-y-4 w-full gap-4",children:[e.jsxs(x,{className:"w-full",children:[e.jsxs(u,{children:[e.jsx(m,{children:"Total Presensi Hari Ini"}),e.jsx(g,{children:"Jumlah pegawai yang melakukan presensi hari ini"})]}),e.jsx(f,{children:e.jsx("h1",{className:"text-4xl",children:d.length})})]}),e.jsxs(x,{className:"w-full",children:[e.jsxs(u,{children:[e.jsx(m,{children:"Total Presensi Keseluruhan"}),e.jsx(g,{children:"Jumlah keseluruhan presensi"})]}),e.jsx(f,{children:e.jsx("h1",{className:"text-4xl",children:R})})]}),e.jsxs(x,{className:"w-full",children:[e.jsxs(u,{children:[e.jsx(m,{children:"Total Pegawai"}),e.jsx(g,{children:"Jumlah keseluruhan pegawai"})]}),e.jsx(f,{children:e.jsx("h1",{className:"text-4xl",children:P})})]})]}),e.jsx("div",{className:"flex md:h-full h-[500px] w-full",children:e.jsxs(x,{className:"flex flex-1 flex-col",children:[e.jsxs(u,{className:"flex md:flex-row gap-y-2 flex-col items-center justify-between",children:[e.jsx(m,{children:"Peta Presensi"}),e.jsxs(z,{open:_,onOpenChange:F,children:[e.jsx(U,{asChild:!0,children:e.jsxs(k,{variant:"outline",className:"md:ml-auto w-full md:w-fit",children:["Filter Status ",o.length>0&&`(${o.length})`]})}),e.jsxs($,{align:"end",className:"w-56",children:[e.jsx(q,{children:"Filter Status"}),e.jsx(T,{}),L.map(l=>{const t=d.filter(s=>s.status===l.value).length;return e.jsx("div",{onClick:s=>s.stopPropagation(),children:e.jsx(G,{checked:o.includes(l.value),onSelect:s=>s.preventDefault(),onCheckedChange:s=>I(l.value,s),children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-2",children:[e.jsx(M,{className:h("px-2 py-1 text-xs font-bold",l.color),children:l.label}),e.jsx("span",{className:"rounded-full bg-gray-100 px-2 py-1 text-xs font-medium text-gray-500",children:t})]})})},l.value)}),o.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(T,{}),e.jsx(k,{variant:"ghost",className:"w-full justify-start",onClick:()=>b([]),children:"Reset Filter"})]})]}),e.jsx(ee,{attendances:j,setTanggalAkhir:E,setTanggalAwal:B})]})]}),e.jsx(f,{className:"flex flex-1 flex-col",children:e.jsx(V,{mapRef:r,center:[w,y],zoom:13,className:"overflow-hidden rounded-xl"})})]})})]})]})}export{Le as default};
