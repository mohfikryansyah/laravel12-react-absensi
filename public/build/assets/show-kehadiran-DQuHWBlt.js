import{r as c,j as e}from"./app-BPPpcUO0.js";import{D as I}from"./data-table-DooqsVHG.js";import{B as M}from"./badge-DDEjldrj.js";import{B as T}from"./button-dUqhTS3j.js";import{C as x,a as u,b as h,d as p}from"./card-DU8jBHeJ.js";import{D as B,a as K,b as O,c as z,d as k,e as J}from"./dropdown-menu-ZVHPDP3f.js";import{L as f,d as U,M as $}from"./map-leaflet-BGfTSyjS.js";import{A as q}from"./app-layout-DLSopLB2.js";import{c as g}from"./utils-jAU0Cazi.js";import{R as G,C as Q,a as V}from"./server.browser-Dg3f4qmF.js";import{statuses as N}from"./data-CDMNp-s3.js";import{columns as W}from"./columns-toXKXoGE.js";import X from"./filter-rentang-tanggal-sID6KxA7.js";import{f as F}from"./format-acRrnPkz.js";import{i as Y}from"./id-vBssW-nJ.js";import"./index-DH9YNmbs.js";import"./index-xMlDHO30.js";import"./index-DjsmBRup.js";import"./index-Ufo_pI01.js";import"./createLucideIcon-D4gk0Ghz.js";import"./check-FGQ0vYk-.js";import"./chevron-left-jXA0GYtW.js";import"./chevron-right-CWTnHUZ0.js";import"./input-0P5_JQ_P.js";import"./command-BEEZiI_5.js";import"./popover-BT06q9pB.js";import"./separator-BAeYuKQa.js";import"./index-CbpsmW50.js";import"./use-initials-C47VN5KJ.js";import"./chevrons-up-down-DbqxHM52.js";import"./app-logo-icon-krJiGLo8.js";import"./building-2-DbISyhhV.js";import"./plane-5-6Cif7b.js";import"./data-table-column-header-CGM-8cM8.js";import"./dialog-9hEygwO4.js";import"./data-B3rcImwO.js";import"./calendar-6HkWXe8U.js";import"./label-DCKxiXaS.js";const Z=[{title:"Kehadiran",href:"/attendances"},{title:"Detail Kehadiran",href:"#"}];function Ie({attendances:r,office:o}){const a=c.useRef(null),j=c.useRef(null),y=o.latitude,b=o.longitude,D=f.latLng(y,b),[d,v]=c.useState([]),[L,A]=c.useState(!1),[S,R]=c.useState(null),[C,E]=c.useState(null);F(new Date,"yyyy-MM-dd");const w=r.filter(t=>{let s=!0;if(t.tanggal){const n=new Date(t.tanggal),m=S?new Date(S):null;let i=C?new Date(C):null;i&&i.setHours(23,59,59,999),m&&i?s=n>=m&&n<=i:m?s=n>=m:i&&(s=n<=i)}let l=!0;return d.length>0&&(l=d.includes(String(t.status))),s&&l});c.useEffect(()=>{const t=setTimeout(()=>{a.current&&(a.current.eachLayer(s=>{var l;s instanceof f.Marker&&((l=a.current)==null||l.removeLayer(s))}),j.current&&a.current.removeLayer(j.current),j.current=f.circle(D,{color:"red",radius:o.radius}).addTo(a.current),w.forEach(s=>{const l=N.find(_=>_.value===s.status),n=s.latitude??0,m=s.longitude??0,i=f.latLng(n,m);let P=G.renderToString(e.jsxs("div",{className:"w-[200px]",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"text-xl text-gray-500"}),e.jsx("h1",{className:"font-bold text-gray-800",children:s.user.name})]}),e.jsx(M,{className:g("mt-2 w-full px-2 py-1 text-xs font-bold",l==null?void 0:l.color),children:l==null?void 0:l.label}),e.jsxs("div",{className:"my-2 flex justify-between rounded-lg text-sm text-gray-700",children:[e.jsxs("div",{className:"flex flex-col items-start gap-y-2",children:[e.jsx("span",{className:"font-medium",children:"Jam Masuk:"}),e.jsx("span",{className:g("rounded-md px-2 py-1 font-semibold",s.clock_in>o.clock_in?"bg-red-100 text-red-500":"bg-green-100 text-green-500"),children:s.clock_in})]}),e.jsxs("div",{className:"flex flex-col items-start gap-y-2",children:[e.jsx("span",{className:"font-medium",children:"Jam Keluar:"}),e.jsx("span",{className:g("rounded-md px-2 py-1 font-semibold",s.clock_out?s.clock_out>o.clock_out?"bg-green-100 text-green-500":"bg-red-100 text-red-500":"bg-gray-200 text-gray-500"),children:s.clock_out||"-"})]})]}),s.swafoto?e.jsxs("div",{className:"relative mt-3",children:[e.jsx("img",{src:"/storage/"+s.swafoto,className:"h-auto w-[200px] rounded-lg border",alt:"Swafoto"}),e.jsx("div",{className:"absolute top-1 left-1 rounded-full bg-black/50 p-1 text-white",children:e.jsx(V,{className:"text-sm"})})]}):e.jsx("p",{className:"mt-3 text-xs text-gray-500 italic",children:"Swafoto tidak tersedia"}),s.tanggal&&e.jsx("p",{className:"mt-2",children:F(s.tanggal,"EEEE, d MMMM yyyy, HH:mm:ss",{locale:Y})})]}));a.current&&f.marker(i,{icon:U}).addTo(a.current).bindPopup(P)}))},100);return()=>clearTimeout(t)},[w,o.radius,D,a.current]);const H=(t,s)=>{v(l=>s?[...l,t]:l.filter(n=>n!==t))};return e.jsx(q,{breadcrumbs:Z,children:e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[e.jsxs("div",{className:"grid w-full grid-cols-1 gap-4 lg:grid-cols-2 xl:grid-cols-5",children:[e.jsxs(x,{className:"w-full",children:[e.jsx(u,{children:e.jsx(h,{children:"Total Hadir"})}),e.jsx(p,{children:e.jsx("h1",{className:"text-4xl",children:r.filter(t=>t.status==="Hadir").length})})]}),e.jsxs(x,{className:"w-full",children:[e.jsx(u,{children:e.jsx(h,{children:"Total Tidak Hadir"})}),e.jsx(p,{children:e.jsx("h1",{className:"text-4xl",children:r.filter(t=>t.status==="Alpa").length})})]}),e.jsxs(x,{className:"w-full",children:[e.jsx(u,{children:e.jsx(h,{children:"Total Sakit"})}),e.jsx(p,{children:e.jsx("h1",{className:"text-4xl",children:r.filter(t=>t.status==="Sakit").length})})]}),e.jsxs(x,{className:"w-full",children:[e.jsx(u,{children:e.jsx(h,{children:"Total Izin"})}),e.jsx(p,{children:e.jsx("h1",{className:"text-4xl",children:r.filter(t=>t.status==="Izin").length})})]}),e.jsxs(x,{className:"w-full",children:[e.jsx(u,{children:e.jsx(h,{children:"Total Perjalanan Dinas"})}),e.jsx(p,{children:e.jsx("h1",{className:"text-4xl",children:r.filter(t=>t.status==="Perjalanan Dinas").length})})]})]}),e.jsx(I,{columns:W(o),data:r,columnFilter:"status",titleFilter:"Status",optionsFilter:N}),e.jsxs(x,{className:"h-auto",children:[e.jsxs(u,{className:"flex flex-col items-center justify-between gap-y-2 md:flex-row",children:[e.jsx(h,{children:"Peta Presensi"}),e.jsxs(B,{open:L,onOpenChange:A,children:[e.jsx(K,{asChild:!0,children:e.jsxs(T,{variant:"outline",className:"w-full md:ml-auto md:w-fit",children:["Filter Status ",d.length>0&&`(${d.length})`]})}),e.jsxs(O,{align:"end",className:"w-56",children:[e.jsx(z,{children:"Filter Status"}),e.jsx(k,{}),N.map(t=>{const s=w.filter(l=>l.status===t.value).length;return e.jsx("div",{onClick:l=>l.stopPropagation(),children:e.jsx(J,{checked:d.includes(t.value),onSelect:l=>l.preventDefault(),onCheckedChange:l=>H(t.value,l),children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-2",children:[e.jsx(M,{className:g("px-2 py-1 text-xs font-bold",t.color),children:t.label}),e.jsx("span",{className:"rounded-full bg-gray-100 px-2 py-1 text-xs font-medium text-gray-500",children:s})]})})},t.value)}),d.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(k,{}),e.jsx(T,{variant:"ghost",className:"w-full justify-start",onClick:()=>v([]),children:"Reset Filter"})]})]}),e.jsx(X,{attendances:r,setTanggalAkhir:E,setTanggalAwal:R})]})]}),e.jsx(p,{className:"h-[500px]",children:e.jsx($,{mapRef:a,center:[y,b],zoom:13,className:"overflow-hidden rounded-xl"})})]})]})})}export{Ie as default};
