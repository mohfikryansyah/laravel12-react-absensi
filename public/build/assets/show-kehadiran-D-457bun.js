import{r as o,j as e}from"./app-73PXmQ0L.js";import{D as _}from"./data-table-D-2DmYoz.js";import{B as C}from"./badge-BKJStKv9.js";import{B as T}from"./button-DJr14K4H.js";import{C as d,a as m,b as x,d as u}from"./card-D0s5zf5I.js";import{D as I,a as B,b as K,c as O,d as M,e as z}from"./dropdown-menu-DvkTQ6Bm.js";import{L as h,d as J,M as U}from"./map-leaflet-DC9GcGW5.js";import{A as $}from"./app-layout-DvvVNhPu.js";import{c as p}from"./utils-jAU0Cazi.js";import{R as q,C as G,a as Q}from"./server.browser-pUDb-L-X.js";import{statuses as j}from"./data-DC4OYpzU.js";import{columns as V}from"./columns-Chkp3N_x.js";import W from"./filter-rentang-tanggal-CmRvf17X.js";import{i as X}from"./id-vBssW-nJ.js";import{f as Y}from"./format-acRrnPkz.js";import"./index-bOE8_Kzt.js";import"./index-pV9CKLJr.js";import"./createLucideIcon-DD5_lgfx.js";import"./index-UB70wyLq.js";import"./index-DMqs1coT.js";import"./chevron-left-wEpvv7Ym.js";import"./chevron-right-CPWzXe3b.js";import"./input-BRWu1B6n.js";import"./command-CG0RDoL8.js";import"./popover-CMGxnPm8.js";import"./separator-Cpjg_mZm.js";import"./index-DDJRWYR0.js";import"./use-initials-CgDP6PuV.js";import"./chevrons-up-down-DcUrWfdF.js";import"./app-logo-icon-DuJXVUNj.js";import"./building-2-CfzSGeG9.js";import"./plane-D2BoD-0i.js";import"./data-table-column-header-hNheRNkO.js";import"./data-Cx8KfrcC.js";import"./calendar-YcAonO1F.js";import"./label-QG7L0S7C.js";const Z=[{title:"Kehadiran",href:"/attendances"},{title:"Detail Kehadiran",href:"#"}];function Pe({attendances:n,office:i}){const r=o.useRef(null),f=o.useRef(null),N=i.latitude,w=i.longitude,b=h.latLng(N,w),[c,y]=o.useState([]),[k,L]=o.useState(!1),[v,A]=o.useState(null),[S,F]=o.useState(null),g=n.filter(t=>{if(!t.tanggal)return!0;const s=new Date(t.tanggal),l=v?new Date(v):null;let a=S?new Date(S):null;if(a&&a.setHours(23,59,59,999),l&&a){if(!(s>=l&&s<=a))return!1}else if(l){if(!(s>=l))return!1}else if(a&&!(s<=a))return!1;return c.length===0||c.includes(t.status)});o.useEffect(()=>{const t=setTimeout(()=>{r.current&&(r.current.eachLayer(s=>{var l;s instanceof h.Marker&&((l=r.current)==null||l.removeLayer(s))}),f.current&&r.current.removeLayer(f.current),f.current=h.circle(b,{color:"red",radius:i.radius}).addTo(r.current),g.forEach(s=>{const l=j.find(P=>P.value===s.status),a=s.latitude??0,D=s.longitude??0,E=h.latLng(a,D);let H=q.renderToString(e.jsxs("div",{className:"w-[200px]",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"text-xl text-gray-500"}),e.jsx("h1",{className:"font-bold text-gray-800",children:s.user.name})]}),e.jsx(C,{className:p("mt-2 w-full px-2 py-1 text-xs font-bold",l==null?void 0:l.color),children:l==null?void 0:l.label}),e.jsxs("div",{className:"my-2 flex justify-between rounded-lg text-sm text-gray-700",children:[e.jsxs("div",{className:"flex flex-col items-start gap-y-2",children:[e.jsx("span",{className:"font-medium",children:"Jam Masuk:"}),e.jsx("span",{className:p("rounded-md px-2 py-1 font-semibold",s.clock_in>i.clock_in?"bg-red-100 text-red-500":"bg-green-100 text-green-500"),children:s.clock_in})]}),e.jsxs("div",{className:"flex flex-col items-start gap-y-2",children:[e.jsx("span",{className:"font-medium",children:"Jam Keluar:"}),e.jsx("span",{className:p("rounded-md px-2 py-1 font-semibold",s.clock_out?s.clock_out>i.clock_out?"bg-green-100 text-green-500":"bg-red-100 text-red-500":"bg-gray-200 text-gray-500"),children:s.clock_out||"-"})]})]}),s.swafoto?e.jsxs("div",{className:"relative mt-3",children:[e.jsx("img",{src:s.swafoto,className:"h-auto w-[200px] rounded-lg border",alt:"Swafoto"}),e.jsx("div",{className:"absolute top-1 left-1 rounded-full bg-black/50 p-1 text-white",children:e.jsx(Q,{className:"text-sm"})})]}):e.jsx("p",{className:"mt-3 text-xs text-gray-500 italic",children:"Swafoto tidak tersedia"}),s.tanggal&&e.jsx("p",{className:"mt-2",children:Y(s.tanggal,"EEEE, d MMMM yyyy, HH:mm:ss",{locale:X})})]}));r.current&&h.marker(E,{icon:J}).addTo(r.current).bindPopup(H)}))},100);return()=>clearTimeout(t)},[g,i.radius,b,r.current]);const R=(t,s)=>{y(l=>s?[...l,t]:l.filter(a=>a!==t))};return e.jsx($,{breadcrumbs:Z,children:e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[e.jsxs("div",{className:"grid w-full grid-cols-1 gap-4 lg:grid-cols-2 xl:grid-cols-5",children:[e.jsxs(d,{className:"w-full",children:[e.jsx(m,{children:e.jsx(x,{children:"Total Hadir"})}),e.jsx(u,{children:e.jsx("h1",{className:"text-4xl",children:n.filter(t=>t.status==="Hadir").length})})]}),e.jsxs(d,{className:"w-full",children:[e.jsx(m,{children:e.jsx(x,{children:"Total Tidak Hadir"})}),e.jsx(u,{children:e.jsx("h1",{className:"text-4xl",children:n.filter(t=>t.status==="Alpa").length})})]}),e.jsxs(d,{className:"w-full",children:[e.jsx(m,{children:e.jsx(x,{children:"Total Sakit"})}),e.jsx(u,{children:e.jsx("h1",{className:"text-4xl",children:n.filter(t=>t.status==="Sakit").length})})]}),e.jsxs(d,{className:"w-full",children:[e.jsx(m,{children:e.jsx(x,{children:"Total Izin"})}),e.jsx(u,{children:e.jsx("h1",{className:"text-4xl",children:n.filter(t=>t.status==="Izin").length})})]}),e.jsxs(d,{className:"w-full",children:[e.jsx(m,{children:e.jsx(x,{children:"Total Perjalanan Dinas"})}),e.jsx(u,{children:e.jsx("h1",{className:"text-4xl",children:n.filter(t=>t.status==="Perjalanan Dinas").length})})]})]}),e.jsx(_,{columns:V(i),data:n,columnFilter:"status",titleFilter:"Status",optionsFilter:j}),e.jsxs(d,{className:"h-auto",children:[e.jsxs(m,{className:"flex flex-col items-center justify-between gap-y-2 md:flex-row",children:[e.jsx(x,{children:"Peta Presensi"}),e.jsxs(I,{open:k,onOpenChange:L,children:[e.jsx(B,{asChild:!0,children:e.jsxs(T,{variant:"outline",className:"w-full md:ml-auto md:w-fit",children:["Filter Status ",c.length>0&&`(${c.length})`]})}),e.jsxs(K,{align:"end",className:"w-56",children:[e.jsx(O,{children:"Filter Status"}),e.jsx(M,{}),j.map(t=>{const s=g.filter(l=>l.status===t.value).length;return e.jsx("div",{onClick:l=>l.stopPropagation(),children:e.jsx(z,{checked:c.includes(t.value),onSelect:l=>l.preventDefault(),onCheckedChange:l=>R(t.value,l),children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-2",children:[e.jsx(C,{className:p("px-2 py-1 text-xs font-bold",t.color),children:t.label}),e.jsx("span",{className:"rounded-full bg-gray-100 px-2 py-1 text-xs font-medium text-gray-500",children:s})]})})},t.value)}),c.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(M,{}),e.jsx(T,{variant:"ghost",className:"w-full justify-start",onClick:()=>y([]),children:"Reset Filter"})]})]}),e.jsx(W,{attendances:n,setTanggalAkhir:F,setTanggalAwal:A})]})]}),e.jsx(u,{className:"h-[500px]",children:e.jsx(U,{mapRef:r,center:[N,w],zoom:13,className:"overflow-hidden rounded-xl"})})]})]})})}export{Pe as default};
